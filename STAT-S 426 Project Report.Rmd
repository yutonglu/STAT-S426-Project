---
title: |
  | Project Report
  | Baysien Option Pricing Using Mixed Normal Heteroskedasticity Models
author: "Ashley Lu, Liang Zou"
date: "11/28/2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)

```


```{r load data}

setwd("~/Desktop/STAT-S 426/STAT-S426-Project")
SP500 <- read.csv("Data.txt",header = F)
R = c()
for (i in 2:nrow(SP500)){
  R = c(R, log(SP500$V2[i]/SP500$V2[i-1]))
}

```



```{r plot of R}
plot(R,type = 'l')
boxplot(R)
summary(R)

plot(density(R),las = 1, xlab = 'R')
abline(v=0.009, col = 3)
abline(v= -0.01, col = 5)

length(subset(R, R > 0.011))
length(subset(R, R > 0.003 & R < 0.011))

length(subset(R, R > -0.008 & R < 0.003))
length(subset(R, R < -0.008))
```
    
    
    
    
```{r prior of mixture}
# K = # of mixture normal models 
# T = total # of days
# pi = proportion of each normal model
# mu = mean of each normal
# theta = variance of each normal
# v_t ~ Uniform[0,1]
# Gt = k -> which normal model

mu = c(0.009, 0)
s2 = c(0.0001, 0.0001)
p = c(0.6, 0.4)
K = 2 # the number of mixed normal models

```




```{r MCMC}

th = R[1] # the first day of R
THD.MCMC <- NULL
S <- length(R) - 1

for(s in 1:S) {
  pz.unnorm <- p*dnorm(th, mu, sqrt(s2))
  z <- sample(1:K ,1, prob=pz.unnorm) 
    # Note that the sample() function in R normalizes the weights in pz.unnorm. 
    # Otherwise we would have to do it by hand.
  th <- rnorm(1, mu[z], sqrt(s2[z]))
  THD.MCMC <- rbind(THD.MCMC, c(th,z))
}



```




```{r diagnostics}

plot(R, type = 'l', las = 1, ylab = 'R', col = 'green', ylim = c(-0.04,0.03))

lines(c(R[1],THD.MCMC[,1]), type = 'l', col = 'red')

legend('bottomright',legend = c("Real data", 'MCMC prediction'), lty = c(1,1), col = c('green','red'))

(error = 1/S*sum((R[-1]-THD.MCMC[,1])^2))
```




